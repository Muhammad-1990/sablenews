<!DOCTYPE html>
<html lang="en" x-data="blogApp()" x-init="init()">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#01000e" />
    <meta name="Description" content="Sable News">
    <meta name="author" content="github.com/Muhammad-1990/sablenews">
    <title>Sable News</title>
    <meta name="description" content="Sable News">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Sable News">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-TileColor" content="#01000e">

    <meta property="og:title" content="Sable News" />
    <meta property="og:description " content="Sable News" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://muhammad-1990.github.io/sablenews/" />
    <meta property="og:image" content="https://muhammad-1990.github.io/sablenews/manifest-icon-512.png" />

    <meta name="github" content="github.com/muhammad-1990/sablenews" />
    <meta name="twitter" content="@sablenews" />
    <meta name="email" content="muhammad.ahmod@sableinternational.com" />


    <link rel="icon" href="https://muhammad-1990.github.io/sablenews/favicon.ico" type="image/x-icon" />
    <link rel="manifest" href="https://muhammad-1990.github.io/sablenews/manifest.json" />
    <link rel="apple-touch-icon" href="https://muhammad-1990.github.io/sablenews/manifest-icon-512.png" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <style>
        /* Aggressive momentum tuning – especially helps iOS */
        main {
            /* These are not standard, but Safari sometimes respects them indirectly via touch events */
            touch-action: pan-y;
            /* Allows vertical panning */
        }

        /* Snap scrolling */
        .snap-y {
            scroll-snap-type: y proximity;
            /* ← Changed to proximity – try mandatory later */
            -webkit-overflow-scrolling: touch;
            /* Momentum + bounce on iOS */
            overscroll-behavior-y: contain;
            will-change: scroll-position;
            scroll-behavior: smooth;
        }

        .snap-start {
            scroll-snap-align: start;
            transform: translateZ(0);
        }

        /* Optional: smoother scroll feel overall */
        html {
            scroll-behavior: smooth;
            /* But note: can conflict with snap sometimes */
        }

        @layer utilities {
            .scrollbar-hide {
                -ms-overflow-style: none;
                /* IE and Edge */
                scrollbar-width: none;
                /* Firefox */
            }

            .scrollbar-hide::-webkit-scrollbar {
                display: none;
                /* Chrome, Safari, new Edge */
            }
        }

        .animate-bounce-once {
            animation: bounce 0.4s ease-out;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translate(-50%, 0) scale(1);
            }

            50% {
                transform: translate(-50%, -4px) scale(1.2);
            }
        }

        /* Enable iOS-style momentum + bounce on horizontal scroll */
        .overflow-x-auto {
            -webkit-overflow-scrolling: touch;
            /* iOS momentum/inertia + bounce */
            overscroll-behavior-x: contain;
            /* Allows bounce at edges without chaining */
        }

        /* Keep scrollbar hidden (you already had scrollbar-hide) */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .fade-horizontal {
            mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
        }

        .content p {
            margin-bottom: 1rem;
        }

        .content a {
            text-decoration-line: none;
            color: rgb(170 122 26);
        }

        .content h2 {
            line-height: 1.8rem;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            margin-top: 3rem;
        }

        .content ul {
            list-style-type: disc;
            padding-left: 2rem;
        }

        .content ul li {
            margin-bottom: .5rem;
            margin-top: .5rem;
        }

        .content ol {
            margin-bottom: 2.25rem;
            margin-left: 2.25rem;
            margin-top: 0;
        }

        .content ol li {
            list-style-type: decimal;
            margin-bottom: 1rem;
        }

        .content hr {
            display: none;
        }

        .content h4:last-child {
            display: none;
        }

        [x-cloak] {
            display: none !important;
        }
    </style>

    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 440px) and (device-height: 956px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_17_Pro_Max__iPhone_16_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_17_Pro__iPhone_17__iPhone_16_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_16_Plus__iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 420px) and (device-height: 912px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_Air_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_16__iPhone_15_Pro__iPhone_15__iPhone_14_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_16e__iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/iPhone_11__iPhone_XR_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1032px) and (device-height: 1376px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/13__iPad_Pro_M4_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/12.9__iPad_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1210px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/11__iPad_Pro_M4_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/10.9__iPad_Air_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/10.5__iPad_Air_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/10.2__iPad_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/8.3__iPad_Mini_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 440px) and (device-height: 956px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_17_Pro_Max__iPhone_16_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_17_Pro__iPhone_17__iPhone_16_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_16_Plus__iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 420px) and (device-height: 912px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_Air_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_16__iPhone_15_Pro__iPhone_15__iPhone_14_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_16e__iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/iPhone_11__iPhone_XR_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1032px) and (device-height: 1376px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/13__iPad_Pro_M4_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/12.9__iPad_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1210px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/11__iPad_Pro_M4_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/10.9__iPad_Air_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/10.5__iPad_Air_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/10.2__iPad_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/8.3__iPad_Mini_portrait.png">
</head>

<body class="bg-black text-white" :class="showArticle ? 'overflow-hidden' : ''" x-data="blogApp()" x-init="init()">

    <!-- Snap Feed -->
    <main class="h-screen snap-y snap-mandatory pt-14" :class="
        {
            'overflow-y-scroll': !showArticle && !dragging,
            'overflow-y-hidden overflow-hidden': showArticle
        }">
        <template x-for="post in (activeFeed === 'Bookmarks' ? bookmarkedPosts : posts)" :key="post.Id">
            <section :data-post-id="post.Id"
                class="h-screen w-full relative snap-center snap-always cursor-pointer overflow-hidden" :class="{
                        'z-60': showArticle && activePost === post.Id,
                    }">

                <div class="relative w-full h-screen">
                    <!-- Blurred background fill -->
                    <img :src="post.meta?.image" class="absolute h-full object-cover blur-md" />

                    <!-- Actual image centered -->
                    <img :src="post.meta?.image" class="relative h-[50vh] object-cover shadow-lg" />
                            
                </div>

                <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                <div class="absolute bottom-0 left-0 right-0 p-6 overflow-y-auto transform-gpu transition-all duration-300"
                    @click="!showArticle ? openPost(post.Id) : null" :class="{
                        'h-full bg-black/80 backdrop-blur-sm': showArticle && activePost === post.Id,
                        'h-80 bg-transparent overflow-y-hidden overflow-hidden': !showArticle || activePost !== post.Id,
                        'overflow-hidden': dragging || showArticle
                    }" @touchstart="startY = $event.touches[0].clientY; " @touchmove="
                    if (startY < 100) {
                        dragging = true;
                        currentY = $event.touches[0].clientY;
                        let delta = currentY - startY;
                        $el.style.transform = `translateY(${delta}px)`;
                        if (delta > 50) {
                            showArticle = false;
                            dragging = false;
                            $el.style.transform = `translateY(0px)`;
                        }
                    }" @touchend="dragging = false;">
                    <!-- Author and date row -->
                     <div class="flex justify-between  items-center">
                        <p class="text-xs" x-text="getAuthorAndDate(post.meta.author,post.PublicationDate)"></p>
                        <div class="flex justify-end  items-center">
                            <!-- Share button – same styling as your bookmark -->
                            <button @click.stop="sharePost(post.Id, post.Title, post.Summary)"
                                class="ml-2 p-2 rounded-full bg-white/10 items-center transition-transform duration-200  active:scale-90"
                                aria-label="Share this post">
                                <svg class="w-5 h-5 drop-shadow-md" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                            </button>
                            <!-- Bookmark button – inline style -->
                            <!-- <button @click.stop="toggleBookmark(post)"
                                class="ml-2 p-2 rounded-full bg-white/10 items-center transition-transform duration-200  active:scale-90"
                                :class="{ 'text-yellow-400': isBookmarked(post.Id) }">
                                <svg class="w-5 h-5 drop-shadow-md" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        :class="{ 'fill-yellow-400 stroke-yellow-400': isBookmarked(post.Id) }"
                                        d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                                </svg>
                            </button> -->
                        </div>
                    </div>
                    <!-- Title row -->
                    <h2 class="text-xl font-bold" x-text="post.Title"></h2>
                    <!-- Summary row -->
                    <p class="mt-2 text-sm text-gray-200 transition-opacity duration-300" x-text="post.Summary"
                        x-show="!showArticle"></p>
                        <!-- Loading indicator -->
                   <!-- <div 
  x-show="loading && activePost === post.Id" 
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
>
  <div class="w-12 h-12 border-4 border-gray-300 border-t-gray-500 rounded-full animate-spin"></div>
</div> -->

                    <!-- Content row -->
                    <div class="prose prose-lg max-w-none text-sm mt-4 content" x-cloak
                        x-show="showArticle && activePost === post.Id" x-transition x-html="post.Content || ''">
                    </div>
                    <!-- Metadata row – between title and summary -->
                    <div class="flex items-center space-x-6 text-xs my-4 opacity-90" x-show="!showArticle">
                        <!-- Likes -->
                        <button @click.stop="toggleLike(post.Id)"
                            class="flex items-center space-x-1.5 transition-all duration-200 hover:scale-105 active:scale-95"
                            :class="{ 'text-red-500': isLiked(post.Id) }">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                            </svg>
                            <span x-text="post.meta?.likes || '2.3k'"></span>
                        </button>
                        <!-- Comments -->
                        <!-- <button @click.stop="openComments(post.Id)"
                            class="flex items-center space-x-1.5 transition-all duration-200 hover:scale-105 active:scale-95">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z" />
                            </svg>
                            <span x-text="post.meta?.comments || '148'"></span>
                        </button> -->
                        <!-- Views -->
                        <div class="flex items-center space-x-1.5">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                            </svg>
                            <span x-text="post.meta?.views || '45k'"></span>
                        </div>
                    </div>

                    <div x-show="loading && activePost === post.Id" class="animate-pulse space-y-4 py-4">
                        <div class="h-6 bg-gray-300 rounded w-3/4"></div>
                        <div class="h-12 bg-gray-300 rounded w-full"></div>
                        <div class="h-9 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-4 bg-gray-300 rounded w-3/4"></div>
                        <div class="h-3 bg-gray-300 rounded w-full"></div>
                        <div class="h-8 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-6 bg-gray-300 rounded w-3/4"></div>
                        <div class="h-12 bg-gray-300 rounded w-full"></div>
                        <div class="h-9 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        <div class="h-4 bg-gray-300 rounded w-3/4"></div>

                    </div>

                </div>
                </div>
            </section>
        </template>
            <p  x-cloak x-show="activeFeed === 'Bookmarks' && posts.length === 0" x-text="'empty'"></p>
        <div x-ref="loadTrigger" x-show="activeFeed === 'Featured'"></div>
    </main>

</body>

<script>

    function parseMetaTags(metaString) {
        const meta = {};
        metaString
            ?.split(/<br\s*\/?>|\r?\n/)
            .map(line => line.trim())
            .filter(line => line.length > 0)
            .forEach(line => {
                const [key, ...rest] = line.split("=");
                if (key && rest.length) {
                    meta[key.trim()] = rest.join("=").trim();
                }
            });
        return meta;
    }

    function blogApp() {
        return {
            feeds: ["Featured", "Bookmarks"],
            activeFeed: "Featured",
            posts: [],
            activePost: null,
            skip: 0,
            top: 10, // how many to fetch per request
            postsLoading: false,
            hasMore: true,

            bookmarkedPosts: [],
            likedPosts: new Set(),
            showArticle: false,
            overlayExpanded: false,
            closing: false,
            loading: false,
            startY: 0,
            currentY: 0,
            endY: 0,
            dragging: false,
            async init() {
                this.$nextTick(async () => {
                    const trigger = this.$refs.loadTrigger;
                    if (!trigger) return;

                    const observer = new IntersectionObserver(entries => {
                      entries.forEach(async entry => {
                        if (entry.isIntersecting) await this.fetchPosts();
                      });
                    });
                
                    observer.observe(trigger);
                    await this.fetchPostsFromLocalStorage();
                    this.handleDeepLink();
                });
            },

            handleDeepLink() {
                const params = new URLSearchParams(window.location.search);

                let postId = params.get('id');

                if (postId && this.posts.some(p => p.Id === postId)) {
                    // Open that post automatically
                    this.openPost(postId);
                    // Optional: smooth scroll to it
                    setTimeout(() => {
                        document.querySelector(`[data-post-id="${postId}"]`)?.scrollIntoView({ behavior: 'smooth' });
                    }, 300);
                }
            },

            async fetchPostsFromApi() {
                const res = await fetch(
                  `https://www.sableinternational.com/api/blogapp/blogposts?` +
                  `$select=Id,Title,Summary,BlogPostMetaTags,PublicationDate` +
                  `&$orderby=PublicationDate desc` +
                  `&$filter=ParentId eq b92c94f8-ab99-4522-b9e1-0f194960f07c` +
                  `&$skip=${this.skip}&$top=${this.top}`
                );
                const data = await res.json();
                const newPosts = (data.value || data).map(post => ({
                  ...post,
                  meta: parseMetaTags(post.BlogPostMetaTags)
                }));
            
                this.posts = [...this.posts, ...newPosts];
                this.skip += this.top;
                if (newPosts.length < this.top) this.hasMore = false;
            },

            fetchPostsFromLocalStorage() {
                const cached = localStorage.getItem("bookmarkedPosts");
                if (cached) {
                  try {
                    const posts = JSON.parse(cached);
                    this.bookmarkedPosts = posts;
                  } catch (err) {
                    console.error("Failed to parse bookmarks", err);
                  }
                } 
            },

            async fetchPosts() {
                console.log('Fetching posts for feed:', this.activeFeed);
                if (this.postsLoading) return;
                this.postsLoading = true;
                console.log('Loading posts...');

                if (this.activeFeed === "Featured") {
                  await this.fetchPostsFromApi();
                } else if (this.activeFeed === "Bookmarks") {
                  this.fetchPostsFromLocalStorage();
                }
            
                this.postsLoading = false;
            },

            async openPost(id) {
                this.showArticle = true;
                this.activePost = id;
                this.loading = true;
                try {
                    const res = await fetch(`https://www.sableinternational.com/api/blogapp/blogposts(${id})?$select=Content`);
                    const data = await res.json();

                    this.posts = this.posts.map(post =>
                        post.Id === id ? { ...post, Content: data.Content } : post);

                } catch (err) {
                    console.error("Failed to load post", err);
                } finally {
                    this.loading = false;
                }
            },

            async sharePost(Id, Title, Summary) {
                console.log('shareclick')
                const shareData = {
                    title: Title,
                    text: Summary,
                    url: `http://localhost:3000/?id=${Id}`
                };
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    if (err.name !== 'AbortError') { }
                }
            },

            handleSwipe() {
                const delta = this.startY - this.endY;
                if (delta > 50) {
                    // swipe up expands overlay
                    this.overlayExpanded = true;
                } else if (delta < -50) {
                    // dismiss overlay entirely
                    this.closing = true;
                    setTimeout(() => {
                        this.showArticle = false;
                        this.closing = false;
                    }, 300);

                }
            },

            getAuthorAndDate(author, dateStr) {
                console.log('getAuthorAndDate', author, dateStr);
                if (!dateStr) return '';
                const date = new Date(dateStr);
                if (isNaN(date)) return dateStr; // fallback if invalid

                return author + " - " + date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                // → "Feb 4, 2025"
            },

            isBookmarked(id) {
                return this.bookmarkedPosts.find(b => b.Id === id);
            },

            toggleBookmark(post) {
                let bookmarks = JSON.parse(localStorage.getItem("bookmarkedPosts") || "[]");

                const exists = bookmarks.find(b => b.Id === post.Id);
                if (exists) {
                  bookmarks = bookmarks.filter(b => b.Id !== post.Id);
                } else {
                  bookmarks.push(post);
                }
            
                localStorage.setItem("bookmarkedPosts", JSON.stringify(bookmarks));
                this.bookmarkedPosts =bookmarks;
            },

            openSearch() {
                // e.g. this.showSearchModal = true;
                alert("Search coming soon!"); // placeholder
            },

            isLiked(id) {
                return this.likedPosts.has(id);
            },

            toggleLike(id) {
                if (this.likedPosts.has(id)) {
                    this.likedPosts.delete(id);
                    // Optional: call API to unlike
                } else {
                    this.likedPosts.add(id);
                    // Optional: call API to like + increment count
                }
                // Force reactivity if needed
                this.likedPosts = new Set(this.likedPosts);
            },

            openComments(id) {
                // TODO: open comments modal/sheet
                console.log('Open comments for post:', id);
            }
        }
    }




    window.onload = async () => {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker
                .register('./service-worker.js');
        }
    }
</script>

</html>