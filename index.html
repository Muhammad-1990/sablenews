<!DOCTYPE html>
<html lang="en" x-data="blogApp()" x-init="init()">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#1d90f5" />
    <meta name="Description" content="Sable News">
    <meta name="author" content="github.com/Muhammad-1990/sablenews">
    <title>Sable News</title>
    <meta name="description" content="Sable News">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Sable News">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-TileColor" content="#1d90f5">

    <meta property="og:title" content="Sable News" />
    <meta property="og:description " content="Sable News" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://muhammad-1990.github.io/sablenews/" />
    <meta property="og:image" content="https://muhammad-1990.github.io/sablenews/manifest-icon-512.png" />

    <meta name="github" content="github.com/muhammad-1990/sablenews" />
    <meta name="twitter" content="@sablenews" />
    <meta name="email" content="muhammad.ahmod@sableinternational.com" />


    <link rel="icon" href="https://muhammad-1990.github.io/sablenews/favicon.ico" type="image/x-icon" />
    <link rel="manifest" href="https://muhammad-1990.github.io/sablenews/manifest.json" />
    <link rel="apple-touch-icon" href="https://muhammad-1990.github.io/sablenews/manifest-icon-512.png" />
 
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <style>
        /* Aggressive momentum tuning – especially helps iOS */
        main {
            /* These are not standard, but Safari sometimes respects them indirectly via touch events */
            touch-action: pan-y;
            /* Allows vertical panning */
        }

        /* Snap scrolling */
        .snap-y {
            scroll-snap-type: y proximity;
            /* ← Changed to proximity – try mandatory later */
            -webkit-overflow-scrolling: touch;
            /* Momentum + bounce on iOS */
            overscroll-behavior-y: contain;
            will-change: scroll-position;
            scroll-behavior: smooth;
        }

        .snap-start {
            scroll-snap-align: start;
            transform: translateZ(0);
        }

        /* Optional: smoother scroll feel overall */
        html {
            scroll-behavior: smooth;
            /* But note: can conflict with snap sometimes */
        }

        @layer utilities {
            .scrollbar-hide {
                -ms-overflow-style: none;
                /* IE and Edge */
                scrollbar-width: none;
                /* Firefox */
            }

            .scrollbar-hide::-webkit-scrollbar {
                display: none;
                /* Chrome, Safari, new Edge */
            }
        }

        .animate-bounce-once {
            animation: bounce 0.4s ease-out;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translate(-50%, 0) scale(1);
            }

            50% {
                transform: translate(-50%, -4px) scale(1.2);
            }
        }

        /* Enable iOS-style momentum + bounce on horizontal scroll */
        .overflow-x-auto {
            -webkit-overflow-scrolling: touch;
            /* iOS momentum/inertia + bounce */
            overscroll-behavior-x: contain;
            /* Allows bounce at edges without chaining */
        }

        /* Keep scrollbar hidden (you already had scrollbar-hide) */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .fade-horizontal {
            mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
        }
    </style>

    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 440px) and (device-height: 956px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_17_Pro_Max__iPhone_16_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_17_Pro__iPhone_17__iPhone_16_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_16_Plus__iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 420px) and (device-height: 912px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_Air_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_16__iPhone_15_Pro__iPhone_15__iPhone_14_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_16e__iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/iPhone_11__iPhone_XR_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1032px) and (device-height: 1376px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/13__iPad_Pro_M4_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/12.9__iPad_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1210px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/11__iPad_Pro_M4_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/10.9__iPad_Air_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/10.5__iPad_Air_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/10.2__iPad_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="splash_screens/8.3__iPad_Mini_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 440px) and (device-height: 956px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_17_Pro_Max__iPhone_16_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_17_Pro__iPhone_17__iPhone_16_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_16_Plus__iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 420px) and (device-height: 912px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_Air_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_16__iPhone_15_Pro__iPhone_15__iPhone_14_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_16e__iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/iPhone_11__iPhone_XR_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1032px) and (device-height: 1376px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/13__iPad_Pro_M4_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/12.9__iPad_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1210px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/11__iPad_Pro_M4_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/10.9__iPad_Air_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/10.5__iPad_Air_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/10.2__iPad_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="splash_screens/8.3__iPad_Mini_portrait.png">
</head>

<body class="bg-black text-white" :class="showArticle ? 'overflow-hidden' : ''" x-data="blogApp()" x-init="init()">
    <!-- Category Tabs -->
    <nav
    x-show="!showArticle"
        class=".fade-horizontal fixed top-0 left-0 right-0 z-50 bg-black/20 backdrop-blur-sm text-white">
        <div class="relative flex items-center justify-between px-2 py-1">
            <!-- Scrollable categories area -->
            <div class="flex-1 overflow-x-auto scrollbar-hide whitespace-nowrap ">
                <div class="flex justify-center space-x-2 min-w-max">
                    <template x-for="cat in categories" :key="cat">
                        <button @click="activeCategory = cat; fetchPosts(cat)"
                            class="relative px-4 py-2 text-white text-xs font-medium transition-colors" >
                            <span x-text="cat"></span>

                            <!-- Small underline indicator (you had w-6 h-0.5 – kept it) -->
                            <span
                                class="absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-0.5 rounded-full bg-white transition-all duration-300 origin-center"
                                :class="{
                                'opacity-100 scale-x-100': activeCategory === cat,
                                'opacity-0 scale-x-0': activeCategory !== cat
                            }"></span>
                        </button>
                    </template>
                </div>
            </div>

            <!-- Search icon on the right -->
            <button @click="openSearch()"
                class="ml-3 p-2 rounded-full hover:bg-white/10 transition-colors flex items-center justify-center"
                aria-label="Search">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </button>
        </div>
    </nav>

    <!-- Snap Feed -->
    <main class="h-screen snap-y snap-mandatory pt-14" :class="
   {
   'overflow-y-scroll': !showArticle && !dragging,
   'overflow-y-hidden': showArticle,
   }">
        <template x-for="post in posts" :key="post.Id">
            <section class="h-screen w-full relative snap-start cursor-pointer"
            :class="{
            'z-60': showArticle && activePost?.Id === post.Id,
            }"
            :class="closing ? 'h-0 opacity-0' : (overlayExpanded ? 'h-screen opacity-100' : 'h-[50vh] opacity-100')"
            >
                <img :src="post.meta?.image" alt=""
                    class="relative inset-0 w-full h-full object-cover"
                    >
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                <div class="absolute bottom-0 left-0 right-0 p-6 overflow-y-auto
         transition-all duration-700 ease-in-out"
  @click="openPost(post.Id)"
  :class="{
    'h-full bg-black': showArticle && activePost?.Id === post.Id,
    'h-80 bg-transparent': !showArticle || activePost?.Id !== post.Id
  }"

        @touchstart="startY = $event.touches[0].clientY; "
        @touchmove="
     
            console.log('startY:', startY);
            if (startY < 100) {
                currentY = $event.touches[0].clientY;
                let delta = currentY - startY;
                $el.style.transform = `translateY(${delta}px)`;
                if (delta > 50) {
                    showArticle = false;
                    dragging = false;
                    $el.style.transform = `translateY(0px)`;
                }
                
            }
        "

        @touchend=" dragging = false;">
                    <div class="flex justify-between space-x-4 items-center">
                        <p class="text-xs" x-text="getAuthorAndDate(post.meta.author,post.LastModified)"></p>
                        <!-- Bookmark button – inline style -->
                        <button @click.stop="toggleBookmark(post.Id)"
                            class="flex flex-col items-center transition-transform duration-200 hover:scale-110 active:scale-90"
                            :class="{ 'text-yellow-400': isBookmarked(post.Id) }">
                            <svg class="w-6 h-6 drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 32 32"
                                stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    :class="{ 'fill-yellow-400 stroke-yellow-400': isBookmarked(post.Id) }"
                                    d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                            </svg>
                            <span class="text-xs mt-1 font-medium" x-text="post.meta?.bookmarks"></span>
                        </button>
                    </div>

                    <h2 class="text-xl font-bold" x-text="post.Title"></h2>
                    <!-- Metadata row – between title and summary -->
                    <div class="flex items-center space-x-6 text-xs my-4 opacity-90">
                        <!-- Likes -->
                        <button @click.stop="toggleLike(post.Id)"
                            class="flex items-center space-x-1.5 transition-all duration-200 hover:scale-105 active:scale-95"
                            :class="{ 'text-red-500': isLiked(post.Id) }">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                            </svg>
                            <span x-text="post.meta?.likes || '2.3k'"></span>
                        </button>
                        <!-- Comments -->
                        <button @click.stop="openComments(post.Id)"
                            class="flex items-center space-x-1.5 transition-all duration-200 hover:scale-105 active:scale-95">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z" />
                            </svg>
                            <span x-text="post.meta?.comments || '148'"></span>
                        </button>
                        <!-- Views -->
                        <div class="flex items-center space-x-1.5">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                            </svg>
                            <span x-text="post.meta?.views || '45k'"></span>
                        </div>
                    </div>
                    <p class="mt-2 text-sm text-gray-200" x-text="post.Summary" x-show="!showArticle"></p>
                    <div class="prose prose-lg max-w-none text-sm" x-show="showArticle && activePost?.Id === post.Id"
                        x-html="post.Content"></div>
                </div>
            </section>
        </template>
    </main>

    <!--
     translate-y-0 h-[80vh]
      h-auto translate-y-0 
     -->


    <!-- Article Overlay -->
    <!-- <div class="fixed inset-x-0 bottom-0 bg-white text-black z-50 overflow-hidden transition-all duration-300 ease-in-out rounded-t-3xl shadow-2xl"
        x-show="showArticle" x-ref="overlay"
        :class="closing ? 'h-0 opacity-0' : (overlayExpanded ? 'h-screen opacity-100' : 'h-[50vh] opacity-100')"
        @touchstart="startY = $event.touches[0].clientY"
        @touchend="endY = $event.changedTouches[0].clientY; handleSwipe()">
        <div class="overflow-y-auto p-6 h-full">
            <template x-if="activePost">
                <div>
                    <h2 class="text-2xl font-bold" x-text="activePost.Title"></h2>
                    <p class="mt-2 mb-4 text-gray-600" x-text="activePost.Summary"></p>
                    <div class="prose prose-lg max-w-none" x-html="activePost.Content"></div>
                </div>
            </template>
            <template x-if="loading">
                <p class="text-gray-500">Loading...</p>
            </template>
        </div>
    </div> -->

</body>

<script>
    function parseMetaTags(metaString) {
        const meta = {};
        metaString
            ?.split(/<br\s*\/?>|\r?\n/)
            .map(line => line.trim())
            .filter(line => line.length > 0)
            .forEach(line => {
                const [key, ...rest] = line.split("=");
                if (key && rest.length) {
                    meta[key.trim()] = rest.join("=").trim();
                }
            });
        return meta;
    }

    function blogApp() {
        return {
            categories: ["For You", "Accounting", "Citizenship", "Forex", "General", "Immigration", "Investment", "Study Abroad", "Wealth"],
            activeCategory: "For You",
            posts: [],
            activePost: {},
            showArticle: false,
            overlayExpanded: false,
            closing: false,
            loading: false,
            startY: 0,
            currentY: 0,
            endY: 0,
            dragging: false ,
            async init() {
                await this.fetchPosts(this.activeCategory);
            },

            async fetchPosts(category) {
                const res = await fetch("https://www.sableinternational.com/api/blogapp/blogposts?$orderby=LastModified desc&$filter=ParentId eq b92c94f8-ab99-4522-b9e1-0f194960f07c&$top=20");
                const data = await res.json();
                this.posts = (data.value || data).map(post => ({
                    ...post,
                    meta: parseMetaTags(post.BlogPostMetaTags)
                }));
            },

            async openPost(id) {
                this.loading = true;
                this.closing = true;
                this.showArticle = true;
                this.activePost.Id = id;
                console.log(this.posts);
                this.overlayExpanded = false;
                setTimeout(() => { this.closing = false; }, 10);
                try {
                    const res = await fetch(`https://www.sableinternational.com/api/blogapp/blogposts(${id})?$select=Id,Title,Summary,Content`);
                    const data = await res.json();
                    this.activePost = data;
                } catch (err) {
                    console.error("Failed to load post", err);
                } finally {
                    this.loading = false;
                }
            },

            handleSwipe() {
                const delta = this.startY - this.endY;
                if (delta > 50) {
                    // swipe up expands overlay
                    this.overlayExpanded = true;
                } else if (delta < -50) {
                        // dismiss overlay entirely
                        this.closing = true;
                        setTimeout(() => {
                            this.showArticle = false;
                            this.closing = false;
                        }, 300);
                   
                }
            },
            getAuthorAndDate(author, dateStr) {
                if (!dateStr) return '';
                const date = new Date(dateStr);
                if (isNaN(date)) return dateStr; // fallback if invalid

                return author + " - " + date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                // → "Feb 4, 2025"
            },

            isBookmarked(id) {
                return this.bookmarkedPosts.has(id);
            },

            toggleBookmark(id) {
                if (this.bookmarkedPosts.has(id)) {
                    this.bookmarkedPosts.delete(id);
                } else {
                    this.bookmarkedPosts.add(id);
                }
                this.bookmarkedPosts = new Set(this.bookmarkedPosts); // trigger reactivity
            },

            openSearch() {
                // e.g. this.showSearchModal = true;
                alert("Search coming soon!"); // placeholder
            },
            likedPosts: new Set(),  // track which posts are liked (persistent if you use localStorage)

            isLiked(id) {
                return this.likedPosts.has(id);
            },

            toggleLike(id) {
                if (this.likedPosts.has(id)) {
                    this.likedPosts.delete(id);
                    // Optional: call API to unlike
                } else {
                    this.likedPosts.add(id);
                    // Optional: call API to like + increment count
                }
                // Force reactivity if needed
                this.likedPosts = new Set(this.likedPosts);
            },

            openComments(id) {
                // TODO: open comments modal/sheet
                console.log('Open comments for post:', id);
            }
        }
    }

    window.onload = async () => {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker
                .register('./service-worker.js');
        }
    }
</script>

</html>