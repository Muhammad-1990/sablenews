<!DOCTYPE html>
<html lang="en" x-data="blogApp()" x-init="init()">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#1d90f5" />
    <meta name="Description" content="Sable News">
    <meta name="author" content="github.com/Muhammad-1990/sablenews">
    <title>Sable News</title>
    <meta name="description" content="Sable News">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Sable News">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-TileColor" content="#1d90f5">

    <meta property="og:title" content="Sable News" />
    <meta property="og:description " content="Sable News" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://muhammad-1990.github.io/sablenews/" />
    <meta property="og:image" content="https://muhammad-1990.github.io/sablenews/manifest-icon-512.png" />

    <meta name="github" content="github.com/muhammad-1990/sablenews" />
    <meta name="twitter" content="@sablenews" />
    <meta name="email" content="muhammad.ahmod@sableinternational.com" />


    <link rel="icon" href="https://muhammad-1990.github.io/sablenews/favicon.ico" type="image/x-icon" />
    <link rel="manifest" href="https://muhammad-1990.github.io/sablenews/manifest.json" />
    <link rel="apple-touch-icon" href="https://muhammad-1990.github.io/sablenews/manifest-icon-512.png" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <style>
        /* Snap scrolling */
        .snap-y {
            scroll-snap-type: y mandatory;
        }

        .snap-start {
            scroll-snap-align: start;
        }

        @layer utilities {
            .scrollbar-hide {
                -ms-overflow-style: none;
                /* IE and Edge */
                scrollbar-width: none;
                /* Firefox */
            }

            .scrollbar-hide::-webkit-scrollbar {
                display: none;
                /* Chrome, Safari, new Edge */
            }
        }

        .animate-bounce-once {
            animation: bounce 0.4s ease-out;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translate(-50%, 0) scale(1);
            }

            50% {
                transform: translate(-50%, -4px) scale(1.2);
            }
        }

        /* Enable iOS-style momentum + bounce on horizontal scroll */
        .overflow-x-auto {
            -webkit-overflow-scrolling: touch;
            /* iOS momentum/inertia + bounce */
            overscroll-behavior-x: contain;
            /* Allows bounce at edges without chaining */
        }

        /* Keep scrollbar hidden (you already had scrollbar-hide) */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .fade-horizontal {
            mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 8%, black 92%, transparent 100%);
        }
    </style>
</head>

<body class="bg-black text-white" :class="showArticle ? 'overflow-hidden' : ''" x-data="blogApp()" x-init="init()">
    <!-- Category Tabs -->
    <nav
        class=".fade-horizontal fixed top-0 left-0 right-0 z-50 bg-gradient-to-b from-black/100 to-transparent backdrop-blur-sm text-white">
        <div class="relative flex items-center justify-between px-4 py-2">
            <!-- Scrollable categories area -->
            <div class="flex-1 overflow-x-auto scrollbar-hide whitespace-nowrap -mx-4 px-4 ">
                <div class="flex justify-center space-x-4 min-w-max">
                    <template x-for="cat in categories" :key="cat">
                        <button @click="activeCategory = cat; fetchPosts(cat)"
                            class="relative px-4 py-2 text-xs font-medium transition-colors" :class="{
                            'text-white': activeCategory === cat,
                            'text-gray-400 hover:text-gray-200': activeCategory !== cat
                        }">
                            <span x-text="cat"></span>

                            <!-- Small underline indicator (you had w-6 h-0.5 â€“ kept it) -->
                            <span
                                class="absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-0.5 rounded-full bg-white transition-all duration-300 origin-center"
                                :class="{
                                'opacity-100 scale-x-100': activeCategory === cat,
                                'opacity-0 scale-x-0': activeCategory !== cat
                            }"></span>
                        </button>
                    </template>
                </div>
            </div>

            <!-- Search icon on the right -->
            <button @click="openSearch()"
                class="ml-3 p-2 rounded-full hover:bg-white/10 transition-colors flex items-center justify-center"
                aria-label="Search">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </button>
        </div>
    </nav>

    <!-- Snap Feed -->
    <main class="h-screen snap-y snap-mandatory pt-14" :class="{
        'overflow-y-scroll': !showArticle,
        'overflow-y-hidden': showArticle,
    }">
        <template x-for="post in posts" :key="post.Id">
            <section class="h-screen w-full relative snap-start cursor-pointer">
                <img :src="post.meta?.image" alt=""
                    class="relative inset-0 w-full h-full object-cover transition-all duration-5000 ease-in-out" :class="{
                    'h-96':showArticle && activePost?.Id === post.Id
                }">
                <div class="absolute inset-0 bg-gradient-to-t from-black/100 to-transparent"></div>
                <div class="absolute bottom-0 left-0 right-0 p-6 overflow-y-auto active:scale-[0.92] active:shadow-inner active:brightness-95
                       transition-[background-color,transform,height,border-radius,box-shadow] 
                       duration-[100ms,800ms,800ms,0ms,800ms] 
                       ease-out ease-in-out ease-in-out ease-in-out ease-in-out
                       delay-[0ms,400ms,400ms,0ms,400ms]" @click="openPost(post.Id)"
                    @mousedown.outside="showArticle = false" :class="{
                    'bg-white text-black rounded-t-3xl shadow-2xl translate-y-0 h-[80vh]': showArticle && activePost?.Id === post.Id,
                    'bg-transparent text-white h-auto translate-y-0': !showArticle || activePost?.Id !== post.Id
                }">
                    <h2 class="text-2xl font-bold" x-text="post.Title"></h2>
                    <p class="mt-2 text-sm text-gray-200" x-text="post.Summary"></p>
                    <div class="prose prose-lg max-w-none" x-show="showArticle && activePost?.Id === post.Id"
                        x-html="post.Content"></div>
                </div>
            </section>
        </template>
    </main>

    <!--
     translate-y-0 h-[80vh]
      h-auto translate-y-0 
     -->


    <!-- Article Overlay -->
    <!-- <div class="fixed inset-x-0 bottom-0 bg-white text-black z-50 overflow-hidden transition-all duration-300 ease-in-out rounded-t-3xl shadow-2xl"
        x-show="showArticle" x-ref="overlay"
        :class="closing ? 'h-0 opacity-0' : (overlayExpanded ? 'h-screen opacity-100' : 'h-[50vh] opacity-100')"
        @touchstart="startY = $event.touches[0].clientY"
        @touchend="endY = $event.changedTouches[0].clientY; handleSwipe()">
        <div class="overflow-y-auto p-6 h-full">
            <template x-if="activePost">
                <div>
                    <h2 class="text-2xl font-bold" x-text="activePost.Title"></h2>
                    <p class="mt-2 mb-4 text-gray-600" x-text="activePost.Summary"></p>
                    <div class="prose prose-lg max-w-none" x-html="activePost.Content"></div>
                </div>
            </template>
            <template x-if="loading">
                <p class="text-gray-500">Loading...</p>
            </template>
        </div>
    </div> -->

</body>

<script>
    function parseMetaTags(metaString) {
        const meta = {};
        metaString
            ?.split(/<br\s*\/?>|\r?\n/)
            .map(line => line.trim())
            .filter(line => line.length > 0)
            .forEach(line => {
                const [key, ...rest] = line.split("=");
                if (key && rest.length) {
                    meta[key.trim()] = rest.join("=").trim();
                }
            });
        return meta;
    }

    function blogApp() {
        return {
            categories: ["For You", "Discover", "Business", "Technology", "Health", "Entertainment"],
            activeCategory: "Discover",
            posts: [],
            activePost: {},
            showArticle: false,
            overlayExpanded: false,
            closing: false,
            loading: false,
            startY: 0,
            endY: 0,
            async init() {
                await this.fetchPosts(this.activeCategory);
            },

            async fetchPosts(category) {
                const res = await fetch("https://www.sableinternational.com/api/blogapp/blogposts?$orderby=LastModified desc&$filter=ParentId eq b92c94f8-ab99-4522-b9e1-0f194960f07c&$top=20");
                const data = await res.json();
                this.posts = (data.value || data).map(post => ({
                    ...post,
                    meta: parseMetaTags(post.BlogPostMetaTags)
                }));
            },

            async openPost(id) {
                // this.loading = true;
                // this.closing = true;
                this.showArticle = true;
                this.activePost.Id = id;
                // this.overlayExpanded = false;
                // setTimeout(() => { this.closing = false; }, 10);
                try {
                    const res = await fetch(`https://www.sableinternational.com/api/blogapp/blogposts(${id})?$select=Id,Title,Summary,Content`);
                    const data = await res.json();
                    this.activePost = data;
                } catch (err) {
                    console.error("Failed to load post", err);
                } finally {
                    this.loading = false;
                }
            },

            handleSwipe() {
                const delta = this.startY - this.endY;
                if (delta > 50) {
                    // swipe up expands overlay
                    this.overlayExpanded = true;
                } else if (delta < -50) {
                    // swipe down
                    if (this.overlayExpanded) {
                        // collapse back to half
                        this.overlayExpanded = false;
                    } else {
                        // dismiss overlay entirely
                        this.closing = true;
                        setTimeout(() => {
                            this.showArticle = false;
                            this.closing = false;
                        }, 300);
                    }
                }
            },

            openSearch() {
                // e.g. this.showSearchModal = true;
                alert("Search coming soon!"); // placeholder
            }
        }
    }

    window.onload = async () => {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker
                .register('./service-worker.js');
        }
    }
</script>

</html>